<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Javascript - 백엔드에서 json 파일 생성에 대한 HTML 출력</title>
</head>
<body>
<input type="button" value="클릭" onclick="ajax_load()">
<div id="box">
	
</div>

</body>
<script>
	/*
		ajax 통신 : 통신 규격 정책 (CORS) → 접속한 사이트 도메인 주소와 AJAX 통신 할 주소가 다를 경우
		CORS 발동 법칙 : 
		1. http냐 https이냐..
		2. www가 있느냐, 도메인만 이냐..
		3. port 80, 8080
	
	*/
	
	function ajax_load(){
		var data;    //json의 데이터를 저장하는 변수
		var ajax = new XMLHttpRequest();
		ajax.onreadystatechange = function(){
			if (ajax.readyState == XMLHttpRequest.DONE){
				if(ajax.status == 200){	//JSON.parse : .json이라는 파일형태가 되었을 경우 사용함
				//백엔드에서 JSON 배열 값을 return 하더라도 모든 데이터는 문자열임
					htmlcode(JSON.parse(this.response));
				}
			}
		}
		ajax.open("GET", "http://172.30.1.32:8080/web_ajax/data.json?v=2", true);	//주소를 정확히 맞춰줘야 함. 조금이라도 다르면 CORS 에러 뜸. 
		//ajax.open("GET", "http://172.30.1.54:8080/web_ajax/ajax3.do", true);	//주소를 정확히 맞춰줘야 함. 조금이라도 다르면 CORS 에러 뜸. 
		ajax.send();		
						
	}
	
	function htmlcode(data){
		var h = document.getElementById("box");
		var html = "";   //html 코드를 누적시키는 변수
		/*
		//forEach : 배열 전용 반복문
		data.forEach(function(a,b,c){	//a : 배열의 그룹단위별 출력, b : 그룹단위 배열번호, c : 배열전체
			console.log(c);
		});
		//console.log(data);
		*/
		
		//for~in : 배열 전용 반복문
		//아래처럼 하면 모두 다 찍힘. 
		for(var a in data) {
			html += "<table border='1' cellpadding='0' cellspacing='0'><tr>";
			for(var b in data[a]){
				html += "<td width='100' align='center'>" + data[a][b] + "</td>";
			}
			html += "</tr></table>"
		}
		h.innerHTML = html;
		
		/*
		for(var a in data[0]) {	
			console.log(a);
			//console.log(data[a]);	
			console.log(data[0][a]);		
		}
		*/
	}
	
	
</script>

</html>


